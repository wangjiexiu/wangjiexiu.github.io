name: Get Citation Data

# 定义触发条件
on:
  # 定时触发， 每天8:00 UTC运行
  schedule:
    - cron: '0 8 * * *'
  # 手动触发选项
  workflow_dispatch:
  # 当推送到 main 分支时触发工作流
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install Python and dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3 python3-pip python3-setuptools

    - name: Install Python requirements
      run: |
        pip3 install -r google_scholar_crawler/requirements.txt

    - name: Run Google Scholar Crawler
      run: |
        cd google_scholar_crawler
        python3 main.py

    - name: Commit and Push updated citation data
      run: |
        cd google_scholar_crawler/results
        git config --local user.name "${GITHUB_ACTOR}"
        git config --local user.email "${GITHUB_ACTOR}@users.noreply.github.com"
        git add *.json
        git commit -m "Updated Citation Data"
        git push "https://${GITHUB_ACTOR}:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git" HEAD:google-scholar-stats
      env:
        GOOGLE_SCHOLAR_ID: ${{ secrets.GOOGLE_SCHOLAR_ID }}
